<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/dash_doodler/blog/rss.xml" title="Doodler Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/dash_doodler/blog/atom.xml" title="Doodler Blog Atom Feed"><title data-react-helmet="true">[ADVANCED] How Doodler works | Doodler</title><meta data-react-helmet="true" property="og:url" content="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/how-doodler-works"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="[ADVANCED] How Doodler works | Doodler"><meta data-react-helmet="true" name="description" content="Doodle extracts features from imagery, and pairs those extracted features with their class distinctions provided by you in the form of &#x27;doodles&#x27;. It creates a Random Forest that predicts the class of each pixel according to the distribution of features extracted from the vicinity of that pixel."><meta data-react-helmet="true" property="og:description" content="Doodle extracts features from imagery, and pairs those extracted features with their class distinctions provided by you in the form of &#x27;doodles&#x27;. It creates a Random Forest that predicts the class of each pixel according to the distribution of features extracted from the vicinity of that pixel."><link data-react-helmet="true" rel="shortcut icon" href="/dash_doodler/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/how-doodler-works"><link data-react-helmet="true" rel="alternate" href="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/how-doodler-works" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://dbuscombe-usgs.github.io/dash_doodler/docs/tutorial-extras/how-doodler-works" hreflang="x-default"><link rel="stylesheet" href="/dash_doodler/assets/css/styles.df7ce140.css">
<link rel="preload" href="/dash_doodler/assets/js/styles.e8a1aa19.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/runtime~main.44c42f64.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/main.dffe1790.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/1.8f385a45.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/2.0d7f3c77.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/34.87eb0714.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/36.c0f28806.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/935f2afb.f7d14936.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/17896441.71558572.js" as="script">
<link rel="preload" href="/dash_doodler/assets/js/174ec309.c5b1d048.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dash_doodler/"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"></strong></a><a class="navbar__item navbar__link navbar__link--active" href="/dash_doodler/docs/intro">Tutorials</a><a class="navbar__item navbar__link" href="/dash_doodler/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Doodler github page</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/dash_doodler/"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/dash_doodler/img/doodler-logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/dash_doodler/docs/intro">Tutorials</a></li><li class="menu__list-item"><a class="menu__link" href="/dash_doodler/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="menu__link">Doodler github page</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/dash_doodler/docs/intro">What is Doodler for?</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Doodler - Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/how-to-doodle">How to Doodle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/deploy-local">Running Doodler on a PC for your own use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/faqs">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/getting-help">Getting help</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/tutorial-basics/glossary">Terminology</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Doodler - Extras</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/dash_doodler/docs/tutorial-extras/how-doodler-works">[ADVANCED] How Doodler works</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/deploy-server">[ADVANCED] Serving Doodler as a web application for others to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/how-to-contribute">[ADVANCED] How to contribute</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/next-steps">[ADVANCED] Next steps .... training a Deep Learning model for image segmentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/dash_doodler/docs/tutorial-extras/references">[ADVANCED] References</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Case Studies</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/case-studies/case-study1">Case Study 1: Greyscale geophysical imagery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/case-studies/case-study2">Case Study 3: NOAA post-hurricane reconnaissance aerial imagery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/dash_doodler/docs/case-studies/case-study3">Case Study 3: USGS post-Hurricane-Florence aerial imagery</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">[ADVANCED] How Doodler works</h1></header><div class="markdown"><p>Doodle extracts features from imagery, and pairs those extracted features with their class distinctions provided by you in the form of &#x27;doodles&#x27;. It creates a <a href="/dash_doodler/docs/tutorial-basics/glossary#random-forest">Random Forest</a> that predicts the class of each pixel according to the distribution of features extracted from the vicinity of that pixel.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Tip</h5></div><div class="admonition-content"><p>Doodler &#x27;learns as you go&#x27;. In a Doodler session, the skill of predictions usually improves the more images you doodle in a single session. That&#x27;s because it updates the Random Forest (RF) model with each set if new image feature - class pairings you provide it</p></div></div><p>The figure below depicts a typical Doodler session in which images (from left to right) are labeled sequentially. The figure is read from left to right, depicting the sequential nature of image labeling, as well as from top to bottom, which depicts the sequence of processes that occur to collectively turn the image image at the top, to the label image at the bottom.</p><p><img src="/dash_doodler/assets/images/paperfig_RFchain_ann-b56a8371bc87b77b219a9e0ca2226667.jpg"></p><p>The first image is &quot;doodled&quot;, and the initial RF is created. That initial RF provides an initial estimate of the entire label estimate, which is fed (with the original image) to a secondary post-processing model based on a fully connected Conditional Random Field model, or CRF for short. The CRF model refines the label image, using the RF model output as priors that are refined to posteriors given the specific image. As such, the RF model is treated as a global model that receives training input from the user over multiple images, and the CRF model is for &#x27;local&#x27; (i.e. image-specific) refinement.</p><p><img src="/dash_doodler/assets/images/paperfig_RFchain_ann-ex1-5703768ffece498c71b5ae8c74370c60.jpg"></p><p>To recap, the program uses two Machine Learning models in concert to segment images using user-provided annotations or &#x27;doodles&#x27;. The two models are 1) Random Forest, or RF, and 2) Fully Connected Conditional Ransom Field (CRF). As such, the program adopts a strategy similar to that described by <a href="https://www.mdpi.com/2076-3263/8/7/244" target="_blank" rel="noopener noreferrer">Buscombe and Ritchie (2018)</a>, in that a &#x27;global&#x27; model trained on many samples is used to provide an initial segmentation on each sample image, then that initial segmentation is refined by a CRF, which operates on a task specific level. In <a href="/dash_doodler/docs/tutorial-extras/references">Buscombe and Ritchie (2018)</a>, the model was a deep neural network trained in advance on large numbers of samples and labels. Here, the model is built as we go, building progressively from user inputs. Doodler uses a Random Forest as the baseline global model, and the CRF implementation is the same as that desribed by Buscombe and Ritchie (2018).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="image-feature-extraction-and-machine-learning-model"></a>Image feature extraction and Machine Learning model<a class="hash-link" href="#image-feature-extraction-and-machine-learning-model" title="Direct link to heading">#</a></h2><p>Images are labeled in sessions. During a session, a RF model is initialized then built progressively using provided labels from each image. The RF model uses features extracted from the image</p><p>The figure below summarizes the feature extraction process. From each sample image, 75 image feature maps are extracted (5 feature types, across 15 unique spatial scales)
<img src="/dash_doodler/assets/images/paperfig_features_ann-27553007eb6a591d6cb64b2a0c3e2d60.jpg"></p><p>The 5 extracted feature types are (&quot;b)&quot; in the figure)</p><ul><li>Intensity: Gaussian blur over a range of scales</li><li>Edges: Sobel filter of the Gaussian blurred images</li><li>Primary texture: Matrix of texture values extacted over a range of scales as the 1st eigenvalue of the Hessian Matrix</li><li>Secondary texture: Matrix of texture values extacted over a range of scales as the 2nd eigenvalue of the Hessian Matrix</li><li>Relative location: the distance in pixels of each pixel to the image origin</li></ul><p>Each RF prediction (a label matrix of integer values, each integer corresponding to a unique class). The CRF builds a model for the likelihood of the RF-predicted labels based on the distributions of features it extracts from the imagery, and can reclassify pixels (it is intended to do so). Its feature extraction and decision making behavior is complex and governed by parameters. The output segmentation is depicted as &quot;c)&quot; in the figure. That prediction then is further refined by applying the model to numerous transformed versions of the image, making predictions, untransforming, and then averaging the stack of resulting predictions. This concept is called <a href="/dash_doodler/docs/tutorial-basics/glossary#test-time-augmentation">test-time-augmentation</a> The output segmentation is depicted as &quot;d)&quot; in the figure. Finally, an optional median filter is applied to the output image to spatially smooth the label.  The output segmentation is depicted as &quot;e)&quot; in the figure.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/dbuscombe-usgs/dash_doodler/edit/master/website/docs/tutorial-extras/how-doodler-works.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dash_doodler/docs/tutorial-basics/glossary"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Terminology</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dash_doodler/docs/tutorial-extras/deploy-server"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">[ADVANCED] Serving Doodler as a web application for others to use Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#image-feature-extraction-and-machine-learning-model" class="table-of-contents__link">Image feature extraction and Machine Learning model</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dash_doodler/docs/intro">Tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/dbuscombe-usgs/coast_train" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coast Train</a></li><li class="footer__item"><a href="https://www.usgs.gov/centers/pcmsc/science/remote-sensing-coastal-change?qt-science_center_objects=0#qt-science_center_objects" target="_blank" rel="noopener noreferrer" class="footer__link-item">USGS Remote Sensing Coastal Change</a></li><li class="footer__item"><a href="https://coastalimagelabeler.science/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coastal Image Labeler by Dr Evan Goldstein</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dash_doodler/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/dbuscombe-usgs/dash_doodler" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://www.makesense.ai/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Makesense.ai (an alternative way to segment imagery)</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Doodler is written and maintained by Daniel Buscombe, Marda Science, LLC, contracted to the U.S. Geological Survey Pacific Coastal and Marine Science Center in Santa Cruz, CA. Doodler development is funded by the U.S. Geological Survey Coastal Hazards Program, and is for the primary usage of U.S. Geological Survey scientists, researchers and affiliated colleagues working on the Hurricane Florence Supplemental Project and other coastal hazards research. Thanks to Jon Warrick, Phil Wernette, Chris Sherwood, Jenna Brown, Andy Ritchie, Jin-Si Over, Christine Kranenburg, and the rest of the Florence Supplemental team; to Evan Goldstein and colleagues at University of North Carolina Greensboro; Leslie Hsu at the USGS Community for Data Integration; and LCDR Brodie Wells, formerly of Naval Postgraduate School, Monterey. Copyright Â© 2021 Marda Science, LLC. </div></div></div></footer></div>
<script src="/dash_doodler/assets/js/styles.e8a1aa19.js"></script>
<script src="/dash_doodler/assets/js/runtime~main.44c42f64.js"></script>
<script src="/dash_doodler/assets/js/main.dffe1790.js"></script>
<script src="/dash_doodler/assets/js/1.8f385a45.js"></script>
<script src="/dash_doodler/assets/js/2.0d7f3c77.js"></script>
<script src="/dash_doodler/assets/js/34.87eb0714.js"></script>
<script src="/dash_doodler/assets/js/36.c0f28806.js"></script>
<script src="/dash_doodler/assets/js/935f2afb.f7d14936.js"></script>
<script src="/dash_doodler/assets/js/17896441.71558572.js"></script>
<script src="/dash_doodler/assets/js/174ec309.c5b1d048.js"></script>
</body>
</html>